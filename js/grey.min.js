// <!-- ...................../´¯/)  -->
// <!-- ....................,/¯../  -->
// <!-- .................../..../  -->
// <!-- ............./´¯/'...'/´¯¯`·¸  成天F12看别人右键 (#‵′)凸 -->
// <!-- ........../'/.../..../......./¨¯\  鄙视你 (#‵′)凸 -->
// <!-- ........('(...´...´.... ¯~/'...')  -->
// <!-- .........\.................'...../  -->
// <!-- ..........''...\.......... _.·´  -->
// <!-- ............\..............(  -->
// <!-- ..............\.............\ -->
//         ´´´´´´´´██´´´´´´´
//         ´´´´´´´████´´´´´´
//         ´´´´´████████´´´´
//         ´´`´███▒▒▒▒███´´´´´
//         ´´´███▒●▒▒●▒██´´´				
//         ´´´███▒▒▒▒▒▒██´´´´´
//         ´´´███▒▒▒▒██´                     
//         ´´██████▒▒███´´´´´                    
//         ´██████▒▒▒▒███´´                    
//         ██████▒▒▒▒▒▒███´´´´                
//         ´´▓▓▓▓▓▓▓▓▓▓▓▓▓▒´´                 
//         ´´▒▒▒▒▓▓▓▓▓▓▓▓▓▒´´´´´              
//         ´.▒▒▒´´▓▓▓▓▓▓▓▓▒´´´´´              
//         ´.▒▒´´´´▓▓▓▓▓▓▓▒                   			 
//         ..▒▒.´´´´▓▓▓▓▓▓▓▒                  		
//         ´▒▒▒▒▒▒▒▒▒▒▒▒                      				
//         ´´´´´´´´´███████´´´´´              
//         ´´´´´´´´████████´´´´´´´
//         ´´´´´´´█████████´´´´´´
//         ´´´´´´██████████´´´´             
//         ´´´´´´██████████´´´                     
//         ´´´´´´´█████████´´
//         ´´´´´´´█████████´´´
//         ´´´´´´´´████████´´´´´
//         ________▒▒▒▒▒
//         _________▒▒▒▒
//         _________▒▒▒▒
//         ________▒▒_▒▒
//         _______▒▒__▒▒
//         _____ ▒▒___▒▒
//         _____▒▒___▒▒
//         ____▒▒____▒▒
//         ___▒▒_____▒▒
//         ███____ ▒▒
//         ████____███
//         █ _███_ _█_███
// ——————————————————————————小心你的浏览器！———————————————————

var bugTF = !1,
	speed = 150,
	allGap = 150,
	changeGap = !0,
	allGap = 150,
	minGap = 100;
$(function() {
	bodyWidth = $(document).width(), bodyHeight = $(document).height(), bgImgWidth = 4 / 3 * bodyHeight,
		errorPipingPosition = bodyHeight / 4, $window = $("#window"), $window_ol = $("#window>ol"), $bird = $("#bird"),
		birdFlyAuto = !0, birdFly(), createWindow();
	skyMoveTime = 1e3 * (bgImgWidth / 30), skyMove(), skyMoveSetTime = setInterval(function() {
		skyMove()
	}, skyMoveTime), $(".start").on("click", () => {
		$(".start").hide(), $window_ol.siblings(".fractionalNum").show(), fractionalNum = 0, birdFlyAuto = !1,
			birdFlyOnce(), clearInterval(skyMoveSetTime), $window_ol.stop(!0), gameStart()
	}), $(".againGame").on("click", () => {
		window.location.reload()
	})
}), $(window).resize(function() {
	window.location.reload()
});

function birdFly() {
	let a = $bird.offset().top;
	birdY = 0, birdFlySetTime = setInterval(() => {
		birdY += 1, a += birdY, $bird.stop(!0).animate({
			top: a
		}, 30), birdFlyAuto && 10 == birdY && (birdY = -10, a += birdY)
	}, 30)
}

function birdFlyOnce() {
	$("main").on("click", () => {
		birdY = -10
	}), $(document).keydown(a => {
		32 == a.keyCode && (birdY = -10)
	})
}

function createWindow() {
	for (let a = 0; 2 > a; a++) $window_ol.append("<li date-key=" + a + "></li>");
	$window_ol.append($window_ol.children().clone()), $window_ol.css({
		width: 4 * bgImgWidth,
		height: bodyHeight
	})
}

function skyMove(a, b) {
	$window_ol.animate({
		left: "-=" + (a || bgImgWidth)
	}, b || skyMoveTime, "linear", () => {
		$window_ol.css("left", "0px")
	})
}

function CreatPiping(a, b) {
	this.num = a + "", this.gap = b || allGap, this.radomDown = errorPipingPosition + Math.round(Math.random() *
			errorPipingPosition), this.radomUp = bodyHeight - this.gap - this.radomDown, this.pipingUp = $("<div class='up'>"),
		this.pipingDown = $("<div class='down'>"), this.pipingUp.addClass(this.num), this.pipingDown.addClass(this.num), this
		.pipingUp.css({
			bottom: -(420 - this.radomUp),
			left: bodyWidth
		}), this.pipingDown.css({
			top: -(420 - this.radomDown),
			left: bodyWidth
		});
	let c = $("#window");
	c.append(this.pipingDown), c.append(this.pipingUp)
}

function PipingMove(a) {
	function b(a) {
		this.piping = a;
		let b = this.positionBird(),
			c = this.positionPiping(this.piping);
		if (b[1] >= c[1] + c[2]) return void(f || (fractionalNum++, $(".fractionalNum").text(fractionalNum), f = !0)); {
			(0 > b[0] || b[0] > bodyHeight) && gameOver();
			let a = this.checkPiping(b[0], b[1], b[2], c[0], c[1], c[2], c[3]);
			a && gameOver()
		}
	}
	this.num = a + "";
	let c = 1e3 * ((bodyWidth + 52) / speed),
		d = $window.find("div.down." + this.num),
		e = $window.find("div.up." + this.num),
		f = !1,
		g = setInterval(() => {
			f || (new b(d), new b(e))
		}, 30, d, e);
	d.animate({
		left: -52
	}, c, "linear", () => {
		d.remove(), clearInterval(g)
	}), e.animate({
		left: -52
	}, c, "linear", () => {
		e.remove(), clearInterval(g)
	}), b.prototype = {
		positionBird: function() {
			let a = $("#bird>div"),
				b = parseInt(a.offset().top),
				c = parseInt(a.offset().left);
			return [b, c, 30]
		},
		positionPiping: function(a) {
			let b = parseInt(a.offset().top),
				c = parseInt(a.offset().left);
			0 > b && (b = 0);
			let d = a.hasClass("down") ? a.css("top") : a.css("bottom");
			let e = parseInt(d) + 420;
			return [b, c, 52, e]
		},
		checkPiping: function(a, b, c, d, e, f, g) {
			return !!(b >= e - c && b <= e + f && a >= d - c && a <= d + g)
		}
	}
}

function gameStart() {
	let a = bgImgWidth + parseFloat($window_ol.css("left")),
		b = 1e3 * (a / speed);
	skyMoveTime = 1e3 * (bgImgWidth / speed), skyMove(a, b), skyMoveOnce = setTimeout(() => {
		skyMove(), skyMoveSetTime = setInterval(function() {
			skyMove()
		}, skyMoveTime)
	}, b), num = 1, testNum = 1, nowGap = allGap, createPiping = setInterval(() => {
		changeGap ? (testNum ? testNum-- : (nowGap -= 5, nowGap < minGap && (nowGap = minGap), testNum = 1), new CreatPiping(
			num, nowGap)) : new CreatPiping(num), new PipingMove(num), num++
	}, skyMoveTime / 4)
}

function gameOver() {
	clearInterval(birdFlySetTime), $bird.stop(!0), clearInterval(createPiping), $window.children("div").stop(!0),
		clearTimeout(skyMoveOnce), clearInterval(skyMoveSetTime), $window_ol.stop(!0), $window.children("span").hide(), $bird
		.stop(!0).css("animation-play-state", "paused"), $("#overGame>div").css("background", "rgba(0, 0, 0, 0.6)"), $(
			"#overGame>div>.over").show()
}
